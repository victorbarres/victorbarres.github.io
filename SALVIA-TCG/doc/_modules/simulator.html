<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>simulator &mdash; TCG 1.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="TCG 1.1 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TCG 1.1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for simulator</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Fri May 09 13:49:40 2014</span>

<span class="sd">@author: Victor Barres</span>

<span class="sd">Define the simulator that runs the SemRep/TCG processes for TCG1.0</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">concept</span> <span class="kn">as</span> <span class="nn">CPT</span>
<span class="kn">import</span> <span class="nn">construction</span> <span class="kn">as</span> <span class="nn">CXN</span>
<span class="kn">import</span> <span class="nn">scene</span> <span class="kn">as</span> <span class="nn">SCN</span>
<span class="kn">import</span> <span class="nn">instance</span> <span class="kn">as</span> <span class="nn">INST</span>
<span class="kn">import</span> <span class="nn">random</span>

<div class="viewcode-block" id="COMP_TRACE"><a class="viewcode-back" href="../code.html#simulator.COMP_TRACE">[docs]</a><span class="k">class</span> <span class="nc">COMP_TRACE</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Competition trace</span>
<span class="sd">    Used by the simulator to keep track of construction instances competition outcomes.</span>
<span class="sd">    A comp_trace object is generated after each competition and stored by the simulator.</span>
<span class="sd">    </span>
<span class="sd">    Data:</span>
<span class="sd">        - winner (CXN_INST): winner instance</span>
<span class="sd">        - loser (CXN_INST): loser instance</span>
<span class="sd">        - winSuit (INT): winer suitability (i.e. suitability of the structure it belongs to)</span>
<span class="sd">        - losSuit (INT): loser suitability (i.e. suitability of the structure it belongs to)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loser</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">winSuit</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">losSuit</span> <span class="o">=</span> <span class="mi">0</span>
</div>
<div class="viewcode-block" id="SIMULATOR"><a class="viewcode-back" href="../code.html#simulator.SIMULATOR">[docs]</a><span class="k">class</span> <span class="nc">SIMULATOR</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulator runs SemRep/TCG processes.</span>
<span class="sd">    The simulator needs to be initialized with a grammar, a SemNet (semantic knowledge) and a visual scene.</span>
<span class="sd">    Max time, thresholds of utterance values and TCG principles flags also need to be defined.</span>
<span class="sd">    </span>
<span class="sd">    Simulation is run by successive calls to proceed() method, until a termination condition is met. Each call to proceed() corresponds to</span>
<span class="sd">    1 time step.</span>
<span class="sd">    </span>
<span class="sd">    Data:</span>
<span class="sd">        &lt;LONG TERM MEMORY&gt;</span>
<span class="sd">        - SemNet (SEM_NET): Semantic network (world knowledge)</span>
<span class="sd">        - grammar (GRAMMAR): Grammatical knowledge</span>
<span class="sd">        </span>
<span class="sd">        &lt;VISUAL INPUT&gt;</span>
<span class="sd">        - scene (SCENE): Currently viewed scene</span>
<span class="sd">        </span>
<span class="sd">        &lt;VISION SYSTEM&gt;</span>
<span class="sd">        - atten (REGION): Region currently under attentional focus</span>
<span class="sd">        - next_atten (REGION): Next attention focus. Can be either defined based on saliency or based on verbal guidance (see produce_utterance())</span>
<span class="sd">        - vis_update (BOOL): Visual update flag</span>
<span class="sd">        - per_regions ([REGION]): Already perceived regions</span>
<span class="sd">        </span>
<span class="sd">        &lt;LANGUAGE SYSTEM&gt;</span>
<span class="sd">        - utter (STR): Produced utterance</span>
<span class="sd">        - incomp_utter (BOOL): Incomplete utterance flag. True if the last utterance did not cover the whole active SemRep. Trigers the VERBAL GUIDANCE!</span>
<span class="sd">        - rd_str (CXN_STRUCT): Last read-out construction structure (useful to implement utterance continuity)</span>
<span class="sd">        - rd_phons ([TP_PHON]): Last read-out phonetic notations (useful to implement utterance continuity)</span>
<span class="sd">        </span>
<span class="sd">        &lt;WORKING MEMORY&gt;</span>
<span class="sd">        - instances ([SCHEMA_INST]): All schema instances</span>
<span class="sd">        - sem_insts ([SEMREP_INST]): All SemRep instances</span>
<span class="sd">        - cxn_insts ([CXN_INST]): All construction instances</span>
<span class="sd">        - cxn_strs ([CXN_STRUCT]): All construction structures        </span>
<span class="sd">        - comp_traces ([COMP_TRACE]): Competition traces. Keep trace of cxn instances competition results</span>
<span class="sd">        </span>
<span class="sd">        &lt;SIMULATION PARAMETERS&gt;</span>
<span class="sd">        - time (INT):  Current simulation time (in relative unit)</span>
<span class="sd">        - max_time (INT): Max simulation duration</span>
<span class="sd">        - utter_time (INT): Last utterance production time</span>
<span class="sd">        </span>
<span class="sd">        &lt;THRESHOLD OF UTTERANCE&gt;</span>
<span class="sd">        - thresh_time (INT): Time threshold (-1 for infinity)</span>
<span class="sd">        - thresh_cxn (INT): Construction number limit (-1 for infinity)</span>
<span class="sd">        - thresh_syll (INT): Syllable length limit (-1 for infinity)</span>
<span class="sd">        </span>
<span class="sd">        &lt;TCG PRINCIPLE FLAGS&gt;</span>
<span class="sd">        - prema_prod (BOOL): Premature production principle</span>
<span class="sd">        - utter_cont (BOOL): Utterance continuity principle</span>
<span class="sd">        - verb_guide (BOOL): Verbal guidance principle</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SemNet</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">atten</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_atten</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vis_update</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">per_regions</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">utter</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incomp_utter</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rd_str</span> <span class="o">=</span> <span class="n">INST</span><span class="o">.</span><span class="n">CXN_STRUCT</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rd_phons</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">instances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sem_insts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cxn_insts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cxn_strs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_traces</span> <span class="o">=</span><span class="p">[]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utter_time</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">thresh_time</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thresh_cxn</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thresh_syll</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">prema_prod</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utter_cont</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verb_guide</span> <span class="o">=</span> <span class="bp">True</span>
    
<div class="viewcode-block" id="SIMULATOR.initialize"><a class="viewcode-back" href="../code.html#simulator.SIMULATOR.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">myGrammar</span><span class="p">,</span> <span class="n">myScene</span><span class="p">,</span> <span class="n">mySemNet</span><span class="p">,</span> <span class="n">maxTime</span><span class="p">,</span> <span class="n">threshTime</span><span class="p">,</span> <span class="n">threshCxn</span><span class="p">,</span> <span class="n">threshSyll</span><span class="p">,</span>
                   <span class="n">premaProd</span><span class="p">,</span> <span class="n">utterCont</span><span class="p">,</span> <span class="n">verbGuide</span><span class="p">,</span> <span class="n">clearData</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the simulator.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            - myGrammar (GRAMMAR): A grammatical knowledge</span>
<span class="sd">            - myScene (SCENCE): The input scene</span>
<span class="sd">            - mySemNet (SEM_NET): The semantic knowledge</span>
<span class="sd">            - maxTime (INT): Max simulation duration</span>
<span class="sd">            - threshTime (INT): Time threshold (-1 for infinity)</span>
<span class="sd">            - threshCxn (INT): Construction number limit (-1 for infinity)</span>
<span class="sd">            - threshSyll (INT): Syllable length limit (-1 for infinity)</span>
<span class="sd">            - premaProd (BOOL): Premature production principle</span>
<span class="sd">            - utterCont (BOOL): Utterance continuity principle</span>
<span class="sd">            - verbGuide (BOOL): Verbal guidance principles</span>
<span class="sd">            - clearData (BOOL): If True, grammatical knowlegde, semantic knowledge and visual input are cleared.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span> <span class="o">=</span> <span class="n">myGrammar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">myScene</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SemNet</span> <span class="o">=</span> <span class="n">mySemNet</span>
        <span class="n">CPT</span><span class="o">.</span><span class="n">CONCEPT</span><span class="o">.</span><span class="n">SEMANTIC_NETWORK</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SemNet</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_time</span> <span class="o">=</span> <span class="n">maxTime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utter_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_traces</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">thresh_time</span> <span class="o">=</span> <span class="n">threshTime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thresh_syll</span> <span class="o">=</span> <span class="n">threshSyll</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thresh_cxn</span> <span class="o">=</span> <span class="n">threshCxn</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">prema_prod</span> <span class="o">=</span> <span class="n">premaProd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utter_cont</span> <span class="o">=</span> <span class="n">utterCont</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verb_guide</span> <span class="o">=</span> <span class="n">verbGuide</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">atten</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_atten</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vis_update</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">per_regions</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">utter</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incomp_utter</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rd_str</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rd_phons</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">instances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sem_insts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cxn_insts</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">clearData</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SemNet</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">None</span>
        
    <span class="c">###########################################################################</span>
    <span class="c"># PRIVATE METHODS</span>
    <span class="c">###########################################################################</span></div>
    <span class="k">def</span> <span class="nf">_randmax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">j</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="c">###########################################################################</span>
    
<div class="viewcode-block" id="SIMULATOR.add_schema_inst"><a class="viewcode-back" href="../code.html#simulator.SIMULATOR.add_schema_inst">[docs]</a>    <span class="k">def</span> <span class="nf">add_schema_inst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sc_inst</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a schema instance to the working memory</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            - sc_inst (SCHEMA_INST)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">sc_inst</span><span class="p">):</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">sc_inst</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">INST</span><span class="o">.</span><span class="n">SCHEMA_INST</span><span class="o">.</span><span class="n">NODE</span> <span class="ow">or</span> <span class="n">sc_inst</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">INST</span><span class="o">.</span><span class="n">SCHEMA_INST</span><span class="o">.</span><span class="n">RELATION</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sc_inst</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sem_insts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sc_inst</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">sc_inst</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">INST</span><span class="o">.</span><span class="n">SCHEMA_INST</span><span class="o">.</span><span class="n">CONSTRUCTION</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sc_inst</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cxn_insts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sc_inst</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="SIMULATOR.ellapsed_time"><a class="viewcode-back" href="../code.html#simulator.SIMULATOR.ellapsed_time">[docs]</a>    <span class="k">def</span> <span class="nf">ellapsed_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Maintenance process.</span>
<span class="sd">        </span>
<span class="sd">        Steps:</span>
<span class="sd">            - Set cxn_inst with activity &lt;= 0 to dead</span>
<span class="sd">            - Set old cxn_inst to activity = 0 (old means it has been read out)</span>
<span class="sd">            - Set cxn_inst to Fresh = False (Fresh only when it has just been invoked)</span>
<span class="sd">            - Validate all instances</span>
<span class="sd">            - Remove dead instances</span>
<span class="sd">            - Advance time</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">sc_inst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">sc_inst</span><span class="o">.</span><span class="n">alive</span><span class="p">):</span>
                <span class="k">continue</span>
            
            <span class="c"># When activation drops to zero, an instance dies</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">sc_inst</span><span class="o">.</span><span class="n">activation</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">sc_inst</span><span class="o">.</span><span class="n">Alive</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            
            <span class="c"># When old, activation falls down (to 0)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">sc_inst</span><span class="o">.</span><span class="n">old</span><span class="p">):</span>
                <span class="n">sc_inst</span><span class="o">.</span><span class="n">activation</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c"># Employ a more subtle policy later for treating already produced instances</span>
            
            <span class="c"># Not fresh anymore</span>
            <span class="n">sc_inst</span><span class="o">.</span><span class="n">Fresh</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        
        <span class="c"># Validate all instances (iteratively find dead ones)</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">someone_died</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">sc_inst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">sc_inst</span><span class="o">.</span><span class="n">alive</span><span class="p">):</span>
                    <span class="k">continue</span>
                
                <span class="c">#  Do maintenance</span>
                <span class="n">sc_inst</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
                <span class="n">someone_died</span> <span class="o">=</span> <span class="n">someone_died</span> <span class="ow">or</span> <span class="ow">not</span><span class="p">(</span><span class="n">sc_inst</span><span class="o">.</span><span class="n">alive</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">someone_died</span><span class="p">):</span>
                <span class="k">break</span>
        
        <span class="c"># Remove dead instances</span>
        <span class="k">for</span> <span class="n">sc_inst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">[:]:</span>
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">sc_inst</span><span class="o">.</span><span class="n">alive</span><span class="p">):</span>
                <span class="k">if</span><span class="p">(</span><span class="n">sc_inst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sem_insts</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sem_insts</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">sc_inst</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">sc_inst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cxn_insts</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cxn_insts</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">sc_inst</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">sc_inst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd_str</span><span class="o">.</span><span class="n">insts</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rd_str</span><span class="o">.</span><span class="n">insts</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">sc_inst</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">sc_inst</span><span class="p">)</span>
        
        <span class="c"># Advance time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">+=</span> <span class="mi">1</span>
                
    <span class="c">###########################################################################</span></div>
<div class="viewcode-block" id="SIMULATOR.deploy_attention"><a class="viewcode-back" href="../code.html#simulator.SIMULATOR.deploy_attention">[docs]</a>    <span class="k">def</span> <span class="nf">deploy_attention</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Orient attention to most salient scene region and keep it under focus until the region&#39;s uncertainty &lt; = 0.</span>
<span class="sd">        Include inhibition of return.</span>
<span class="sd">        </span>
<span class="sd">        This method simulate the effect of (bottom-up) visual saliency on the attention process.</span>
<span class="sd">        IMPORTANT: It can be overridden by verbal guidance (see produce_utterance()). If an utterance is produced orematurely while some information is</span>
<span class="sd">        still missing that would be needed to complete it, the next attentional region is set to the region that contains the piece of infomration</span>
<span class="sd">        needed.</span>
<span class="sd">        </span>
<span class="sd">        Steps:</span>
<span class="sd">            1. Pick most salient region whose uncertainty &gt;=0 (i.e. that has not yet been perceived)</span>
<span class="sd">            2. Keep it under attentional focus until it&#39;s uncertainty &lt;=0. Decrease uncertainty value by 1 ever time step.</span>
<span class="sd">            3. Go back to 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Visual update</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vis_update</span> <span class="o">=</span> <span class="bp">True</span>
        
        <span class="c"># Set the current attention focus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atten</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_atten</span>
        
        <span class="c"># Inspect region (incrementally reduce uncertainty)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atten</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atten</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">atten</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">-=</span> <span class="mi">1</span>
        
        <span class="c"># Find the next target (if no region curently inspected or no uncertainty anymore)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atten</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">atten</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
            
            <span class="c"># Saccade to the most salient region</span>
            <span class="n">max_saliency</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">reg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">regions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">reg</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span> <span class="c"># Already inspected, inhibition of return</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_randmax</span><span class="p">(</span><span class="n">max_saliency</span><span class="p">,</span> <span class="n">reg</span><span class="o">.</span><span class="n">saliency</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">max_saliency</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">saliency</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">next_atten</span> <span class="o">=</span> <span class="n">reg</span>
            
            <span class="k">if</span> <span class="n">max_saliency</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vis_update</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># No more region to attend</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">next_atten</span> <span class="o">=</span> <span class="bp">None</span>
                
    <span class="c">###########################################################################</span></div>
<div class="viewcode-block" id="SIMULATOR.get_semrep_inst"><a class="viewcode-back" href="../code.html#simulator.SIMULATOR.get_semrep_inst">[docs]</a>    <span class="k">def</span> <span class="nf">get_semrep_inst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Look for the SemRep instance linked to a given perceptual schema.</span>
<span class="sd">        Return the SemRep instance if it exists, None otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sem_insts</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">alive</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">schema</span> <span class="o">==</span> <span class="n">schema</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">s</span>
        <span class="k">return</span> <span class="bp">None</span>
    </div>
<div class="viewcode-block" id="SIMULATOR.perceive_schema"><a class="viewcode-back" href="../code.html#simulator.SIMULATOR.perceive_schema">[docs]</a>    <span class="k">def</span> <span class="nf">perceive_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aPercept</span><span class="p">,</span> <span class="n">new_rels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For a given percept, update or create associated SemRep nodes and relations.</span>
<span class="sd">        </span>
<span class="sd">        Notes:</span>
<span class="sd">            - Newly created SemRep relations instances are added to new_rels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">aPercept</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="c"># Case: Object percept</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aPercept</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">SCN</span><span class="o">.</span><span class="n">SCHEMA</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">):</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_semrep_inst</span><span class="p">(</span><span class="n">aPercept</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
            <span class="c"># If there already is a corresponding SemRep node instance -&gt; update</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">aPercept</span><span class="o">.</span><span class="n">replace_concept</span><span class="p">:</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">Update</span><span class="p">(</span><span class="n">aPercept</span><span class="o">.</span><span class="n">concept</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">Update</span><span class="p">(</span><span class="n">aPercept</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">concept</span><span class="p">)</span>
            <span class="c"># Else, create it.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">INST</span><span class="o">.</span><span class="n">NODE_INST</span><span class="p">()</span>
                <span class="n">node</span><span class="o">.</span><span class="n">Instantiate</span><span class="p">(</span><span class="n">aPercept</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">aPercept</span><span class="o">.</span><span class="n">replace_concept</span><span class="p">:</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">Update</span><span class="p">(</span><span class="n">aPercept</span><span class="o">.</span><span class="n">concept</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">add_schema_inst</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="c"># Case: Relation percept</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aPercept</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">SCN</span><span class="o">.</span><span class="n">SCHEMA</span><span class="o">.</span><span class="n">RELATION</span><span class="p">):</span>
            <span class="n">relation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_semrep_inst</span><span class="p">(</span><span class="n">aPercept</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
            <span class="c"># If there already is a corresponding SemRep relation instance -&gt; update</span>
            <span class="k">if</span> <span class="n">relation</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">aPercept</span><span class="o">.</span><span class="n">replace_concept</span><span class="p">:</span>
                    <span class="n">relation</span><span class="o">.</span><span class="n">Update</span><span class="p">(</span><span class="n">aPercept</span><span class="o">.</span><span class="n">concept</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">relation</span><span class="o">.</span><span class="n">Update</span><span class="p">(</span><span class="n">aPercept</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">concept</span><span class="p">)</span>
            <span class="c"># Else, create it</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">relation</span> <span class="o">=</span> <span class="n">INST</span><span class="o">.</span><span class="n">REL_INST</span><span class="p">()</span>
                <span class="n">relation</span><span class="o">.</span><span class="n">Instantiate</span><span class="p">(</span><span class="n">aPercept</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">aPercept</span><span class="o">.</span><span class="n">replace_concept</span><span class="p">:</span>
                    <span class="n">relation</span><span class="o">.</span><span class="n">Update</span><span class="p">(</span><span class="n">aPercept</span><span class="o">.</span><span class="n">concept</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">add_schema_inst</span><span class="p">(</span><span class="n">relation</span><span class="p">)</span>
                <span class="n">new_rels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">relation</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="SIMULATOR.perceive_scene"><a class="viewcode-back" href="../code.html#simulator.SIMULATOR.perceive_scene">[docs]</a>    <span class="k">def</span> <span class="nf">perceive_scene</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perceive all regions that are certain (uncertainty == 0) and set their uncertainty to -1 so that they won&#39;t be perceived again.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_rels</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c"># Reset perceived regions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">per_regions</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c"># Perceive regions that are certain (uncertainty == 0)</span>
        <span class="k">for</span> <span class="n">rgn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">regions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rgn</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c"># Perceive schemas</span>
                <span class="k">for</span> <span class="n">percept</span> <span class="ow">in</span> <span class="n">rgn</span><span class="o">.</span><span class="n">percepts</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">perceive_schema</span><span class="p">(</span><span class="n">percept</span><span class="p">,</span> <span class="n">new_rels</span><span class="p">)</span>
                
                <span class="n">rgn</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">-=</span> <span class="mi">1</span> <span class="c"># Region won&#39;t be perceived anymore</span>
                
                <span class="c"># Append traces for perceived regions</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">per_regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rgn</span><span class="p">)</span>
        
        <span class="c"># Establish connection of the newly created SemRep relations</span>
        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">new_rels</span><span class="p">:</span>
            <span class="n">sc_rel</span> <span class="o">=</span> <span class="n">rel</span><span class="o">.</span><span class="n">schema</span>
            
            <span class="c"># Connect node instances</span>
            <span class="n">rel</span><span class="o">.</span><span class="n">pFrom</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_semrep_inst</span><span class="p">(</span><span class="n">sc_rel</span><span class="o">.</span><span class="n">pFrom</span><span class="p">)</span>
            <span class="n">rel</span><span class="o">.</span><span class="n">pTo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_semrep_inst</span><span class="p">(</span><span class="n">sc_rel</span><span class="o">.</span><span class="n">pTo</span><span class="p">)</span>
            
            <span class="c"># Alive only when the full connection is valid</span>
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">rel</span><span class="o">.</span><span class="n">pFrom</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span><span class="p">(</span><span class="n">rel</span><span class="o">.</span><span class="n">pTo</span><span class="p">):</span>
                <span class="n">alive</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">alive</span> <span class="o">=</span> <span class="bp">True</span>
                
            <span class="n">rel</span><span class="o">.</span><span class="n">Alive</span><span class="p">(</span><span class="n">alive</span><span class="p">)</span>
    
    <span class="c">###########################################################################</span></div>
<div class="viewcode-block" id="SIMULATOR.pair_node"><a class="viewcode-back" href="../code.html#simulator.SIMULATOR.pair_node">[docs]</a>    <span class="k">def</span> <span class="nf">pair_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_inst</span><span class="p">,</span> <span class="n">node_elem</span><span class="p">,</span> <span class="n">aCxn</span><span class="p">,</span> <span class="n">attaches</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        WRITE DOCSTRING!!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">semrep_inst</span> <span class="ow">in</span> <span class="n">attaches</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">semrep_inst</span> <span class="o">==</span> <span class="n">node_inst</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">aCxn</span><span class="o">.</span><span class="n">SemFrame</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">==</span> <span class="n">node_elem</span>
            <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
            
        <span class="k">return</span> <span class="bp">False</span>
        </div>
<div class="viewcode-block" id="SIMULATOR.invoke_cxn_inst"><a class="viewcode-back" href="../code.html#simulator.SIMULATOR.invoke_cxn_inst">[docs]</a>    <span class="k">def</span> <span class="nf">invoke_cxn_inst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aCxn</span><span class="p">,</span> <span class="n">sf_idx</span><span class="p">,</span> <span class="n">attaches</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        WRITE DOCSTRING!!</span>
<span class="sd">        SUBGRAPH MATCHING ALGORITHM.        </span>
<span class="sd">        </span>
<span class="sd">        Try to match the SemFrame of a construction onto a SemRep subgraph. If</span>
<span class="sd">        success, instantiate construction.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            - aCxn (CXN): A construction in the grammar.</span>
<span class="sd">            - sf_idx (INT): Index of SemFrame element in aCXN.SemFrame.</span>
<span class="sd">            - attaches ([SEMREP_INST]): Keeps track of the SemRep instances that have been matched during</span>
<span class="sd">            recursive search of matching subgraphs.</span>
<span class="sd">        </span>
<span class="sd">        Notes:</span>
<span class="sd">            - Only instantiates construction that match onto a SemRep sugraph that has</span>
<span class="sd">            at least one element alive.</span>
<span class="sd">            - Checks that a similar instance doesn&#39;t already exist before adding to working</span>
<span class="sd">            memory.</span>
<span class="sd">            - Algorithm steps:</span>
<span class="sd">                - For first element of SemFrame, try to find matching SemRep instance</span>
<span class="sd">                - Then recursively try to find matches for other elements of the SemFrame</span>
<span class="sd">                - Then check that topology match between SemFrame and list of matching attached SemFrame </span>
<span class="sd">                instances (i.e. check that toplogy match between SemFrame and Attatches)</span>
<span class="sd">            - Algorithm comments:</span>
<span class="sd">                - This does not make use of the directed graph structure during the first search phase since</span>
<span class="sd">                it only checks the topology afterwards.</span>
<span class="sd">                - If SemRep = N1 elements, SemFrame = N2 elements, number of test during search = N1^N2 !! + </span>
<span class="sd">                then the cost of the topology checks... this algorithm is clearly NOT optimal, but works for now</span>
<span class="sd">                since SemRep and SemFrames are small.</span>
<span class="sd">            </span>
<span class="sd">            - The matching of concept is very simple here (match or no match).   </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sf_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">aCxn</span><span class="o">.</span><span class="n">SemFrame</span><span class="p">):</span> <span class="c"># Still some SemFrame elements to process</span>
            <span class="n">sf_elem</span> <span class="o">=</span> <span class="n">aCxn</span><span class="o">.</span><span class="n">SemFrame</span><span class="p">[</span><span class="n">sf_idx</span><span class="p">]</span>
            
            <span class="c"># Iterate for all SemRep instances to find a potential match</span>
            <span class="k">for</span> <span class="n">sr_inst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sem_insts</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">sr_inst</span><span class="o">.</span><span class="n">alive</span><span class="p">):</span>
                    <span class="k">continue</span>
                
                <span class="c"># Need to have the same type</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">sr_inst</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">INST</span><span class="o">.</span><span class="n">SCHEMA_INST</span><span class="o">.</span><span class="n">NODE</span> <span class="ow">and</span> <span class="n">sf_elem</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">CXN</span><span class="o">.</span><span class="n">TP_ELEM</span><span class="o">.</span><span class="n">NODE</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="p">(</span><span class="n">sr_inst</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">INST</span><span class="o">.</span><span class="n">SCHEMA_INST</span><span class="o">.</span><span class="n">RELATION</span> <span class="ow">and</span> <span class="n">sf_elem</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">CXN</span><span class="o">.</span><span class="n">TP_ELEM</span><span class="o">.</span><span class="n">RELATION</span><span class="p">)):</span>
                    <span class="k">continue</span>
                
                <span class="c"># Check if the SemRep instances has already been matched with another SemFrame element of aCxn</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">sr_inst</span> <span class="ow">in</span> <span class="n">attaches</span><span class="p">):</span>
                    <span class="k">continue</span>
                
                <span class="c"># Check if concepts match</span>
                <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">CPT</span><span class="o">.</span><span class="n">CONCEPT</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">sr_inst</span><span class="o">.</span><span class="n">concept</span><span class="p">,</span> <span class="n">sf_elem</span><span class="o">.</span><span class="n">concept</span><span class="p">)):</span>
                    <span class="k">continue</span>
                
                <span class="n">attaches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sr_inst</span><span class="p">)</span>
                
                <span class="c"># Recursively call function for next SemFrame element of the consrtruction</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">invoke_cxn_inst</span><span class="p">(</span><span class="n">aCxn</span><span class="p">,</span> <span class="n">sf_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">attaches</span><span class="p">)</span>
                
                <span class="n">attaches</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Topology check</span>
            <span class="n">fresh</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">sr_inst</span> <span class="ow">in</span> <span class="n">attaches</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sr_inst</span><span class="o">.</span><span class="n">fresh</span><span class="p">:</span> <span class="c"># At least one instance has to be fresh</span>
                    <span class="n">fresh</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">sr_inst</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">INST</span><span class="o">.</span><span class="n">SCHEMA_INST</span><span class="o">.</span><span class="n">RELATION</span><span class="p">:</span>
                    <span class="k">continue</span> <span class="c"># Only look at relations to determine topology match.</span>
                    
                <span class="n">rel_elem</span> <span class="o">=</span> <span class="n">aCxn</span><span class="o">.</span><span class="n">SemFrame</span><span class="p">[</span><span class="n">attaches</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sr_inst</span><span class="p">)]</span> <span class="c"># SemFrame relation element corresponding to the SemRep relation</span>
                
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pair_node</span><span class="p">(</span><span class="n">sr_inst</span><span class="o">.</span><span class="n">pFrom</span><span class="p">,</span> <span class="n">rel_elem</span><span class="o">.</span><span class="n">pFrom</span><span class="p">,</span> <span class="n">aCxn</span><span class="p">,</span> <span class="n">attaches</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pair_node</span><span class="p">(</span><span class="n">sr_inst</span><span class="o">.</span><span class="n">pTo</span><span class="p">,</span> <span class="n">rel_elem</span><span class="o">.</span><span class="n">pTo</span><span class="p">,</span> <span class="n">aCxn</span><span class="p">,</span> <span class="n">attaches</span><span class="p">)):</span>
                    <span class="k">return</span> <span class="c"># Stop invocation</span>
            
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">fresh</span><span class="p">):</span>
                <span class="k">return</span> <span class="c"># Stop invocation</span>
            
            <span class="c"># Invoke a new construction instance</span>
            <span class="n">new_cxn_inst</span> <span class="o">=</span> <span class="n">INST</span><span class="o">.</span><span class="n">CXN_INST</span><span class="p">()</span>
            <span class="n">new_cxn_inst</span><span class="o">.</span><span class="n">instantiate</span><span class="p">(</span><span class="n">aCxn</span><span class="p">,</span> <span class="n">attaches</span><span class="p">[:],</span> <span class="mi">100</span><span class="p">)</span>
            
            <span class="c"># Check if there already is an indentical construction instance</span>
            <span class="k">for</span> <span class="n">anInst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cxn_insts</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">anInst</span><span class="o">.</span><span class="n">alive</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">new_cxn_inst</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">anInst</span><span class="p">):</span>
                    <span class="k">return</span> <span class="c"># Identical instance already exists</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">add_schema_inst</span><span class="p">(</span><span class="n">new_cxn_inst</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="SIMULATOR.invoke_constructions"><a class="viewcode-back" href="../code.html#simulator.SIMULATOR.invoke_constructions">[docs]</a>    <span class="k">def</span> <span class="nf">invoke_constructions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Invoke all constructions whose SemFrame match SemRep subgraphs (no duplicate).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attaches</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">aCxn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">constructions</span><span class="p">:</span>            
            <span class="c"># Match SemFrame elements of aCxn against SemRep subgraphs.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">invoke_cxn_inst</span><span class="p">(</span><span class="n">aCxn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">attaches</span><span class="p">)</span>

    <span class="c">###########################################################################</span></div>
<div class="viewcode-block" id="SIMULATOR.find_cxn_struct"><a class="viewcode-back" href="../code.html#simulator.SIMULATOR.find_cxn_struct">[docs]</a>    <span class="k">def</span> <span class="nf">find_cxn_struct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cxn_str</span><span class="p">,</span> <span class="n">cxn_str_list</span><span class="p">,</span> <span class="n">comp_val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        WRITE DOCSTRING!!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">aCxn_str</span> <span class="ow">in</span> <span class="n">cxn_str_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cxn_str</span> <span class="o">==</span> <span class="n">aCxn_str</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">cxn_str</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">aCxn_str</span><span class="p">)</span> <span class="o">==</span> <span class="n">comp_val</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
        
        <span class="k">return</span> <span class="bp">False</span>
    </div>
<div class="viewcode-block" id="SIMULATOR.do_cooperation"><a class="viewcode-back" href="../code.html#simulator.SIMULATOR.do_cooperation">[docs]</a>    <span class="k">def</span> <span class="nf">do_cooperation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        WRITE DOCSTRING!!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Clear all the previously spawned construction structures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cxn_strs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cxn_inst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cxn_insts</span><span class="p">:</span>
            <span class="n">cxn_inst</span><span class="o">.</span><span class="n">cxn_struct</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="c"># Initialize construction hiearchy structures, a cxn_str for each alive cxn_inst</span>
        <span class="k">for</span> <span class="n">cxn_inst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cxn_insts</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">cxn_inst</span><span class="o">.</span><span class="n">alive</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="c"># Spawn a new structure</span>
            <span class="n">new_cxn_str</span> <span class="o">=</span> <span class="n">INST</span><span class="o">.</span><span class="n">CXN_STRUCT</span><span class="p">()</span>
            <span class="n">new_cxn_str</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">cxn_inst</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cxn_strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_cxn_str</span><span class="p">)</span>
            
        <span class="c">#</span>
        <span class="c"># Cooperation process (iteratively spawn all possible construction structures)</span>
        <span class="c">#</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">new_structs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cxn_strs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">cxn_str1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cxn_strs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cxn_strs</span><span class="p">)):</span>
                    <span class="n">cxn_str2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cxn_strs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    
                    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">cxn_str1</span><span class="o">.</span><span class="n">fresh</span> <span class="ow">or</span> <span class="n">cxn_str2</span><span class="o">.</span><span class="n">fresh</span><span class="p">):</span>
                        <span class="k">continue</span> <span class="c"># At least one structure has to be fresh</span>
                    
                    <span class="c"># Try to combine two structures to spawn a new structure</span>
                    <span class="n">new_cxn_str</span> <span class="o">=</span> <span class="n">INST</span><span class="o">.</span><span class="n">CXN_STRUCT</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">cxn_str1</span><span class="p">,</span> <span class="n">cxn_str2</span><span class="p">)</span>
                    
                    <span class="c"># Check if there is already an identical structure</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">new_cxn_str</span> <span class="ow">and</span> 
                        <span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_cxn_struct</span><span class="p">(</span><span class="n">new_cxn_str</span><span class="p">,</span> <span class="n">new_structs</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="ow">and</span>
                        <span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_cxn_struct</span><span class="p">(</span><span class="n">new_cxn_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cxn_strs</span><span class="p">,</span> <span class="mi">3</span><span class="p">))):</span>
                        <span class="n">new_structs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_cxn_str</span><span class="p">)</span>
            
            <span class="c"># Reset freshness of structures</span>
            <span class="k">for</span> <span class="n">cxn_str</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cxn_strs</span><span class="p">:</span>
                <span class="n">cxn_str</span><span class="o">.</span><span class="n">fresh</span> <span class="o">=</span> <span class="bp">False</span>
            
            <span class="c"># Add newly spawned structures</span>
            <span class="k">for</span> <span class="n">new_str</span> <span class="ow">in</span> <span class="n">new_structs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cxn_strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_str</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">new_structs</span><span class="p">):</span>
                <span class="k">break</span> <span class="c"># No more structure spawned                                </span>
                                </div>
<div class="viewcode-block" id="SIMULATOR.create_comp_trace"><a class="viewcode-back" href="../code.html#simulator.SIMULATOR.create_comp_trace">[docs]</a>    <span class="k">def</span> <span class="nf">create_comp_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">winner</span><span class="p">,</span> <span class="n">loser</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        WRITE DOCSTRING!!</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            - winner (CXN_INST)</span>
<span class="sd">            - loser (CXN_INST)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">comp_trace</span> <span class="o">=</span> <span class="n">COMP_TRACE</span><span class="p">()</span>
        <span class="n">comp_trace</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="n">winner</span>
        <span class="n">comp_trace</span><span class="o">.</span><span class="n">loser</span> <span class="o">=</span> <span class="n">loser</span>
        <span class="n">comp_trace</span><span class="o">.</span><span class="n">winSuit</span> <span class="o">=</span> <span class="n">winner</span><span class="o">.</span><span class="n">cxn_struct</span><span class="o">.</span><span class="n">suitability</span>
        <span class="n">comp_trace</span><span class="o">.</span><span class="n">losSuit</span> <span class="o">=</span> <span class="n">loser</span><span class="o">.</span><span class="n">cxn_struct</span><span class="o">.</span><span class="n">suitability</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp_trace</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="SIMULATOR.do_competition"><a class="viewcode-back" href="../code.html#simulator.SIMULATOR.do_competition">[docs]</a>    <span class="k">def</span> <span class="nf">do_competition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        WRITE DOCSTRING!!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Clear all previous competition traces</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_traces</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c"># Initialize alive construction instances</span>
        <span class="n">alive_insts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cxn_inst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cxn_insts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cxn_inst</span><span class="o">.</span><span class="n">alive</span><span class="p">:</span>
                <span class="n">alive_insts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cxn_inst</span><span class="p">)</span>
        
        <span class="c">#</span>
        <span class="c"># Competition process (even if an instance is dead during competition, it still can kill others)</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">alive_insts</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">cxn_inst1</span> <span class="o">=</span> <span class="n">alive_insts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">alive_insts</span><span class="p">)):</span>
                <span class="n">cxn_inst2</span> <span class="o">=</span> <span class="n">alive_insts</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                
                <span class="n">mat_info</span> <span class="o">=</span> <span class="n">INST</span><span class="o">.</span><span class="n">MATCH_INFO</span><span class="p">()</span>
                
                <span class="k">if</span><span class="p">(</span><span class="ow">not</span><span class="p">(</span><span class="n">INST</span><span class="o">.</span><span class="n">CXN_INST</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">cxn_inst1</span><span class="p">,</span> <span class="n">cxn_inst2</span><span class="p">,</span> <span class="n">mat_info</span><span class="p">))</span> <span class="ow">and</span>
                    <span class="n">cxn_inst1</span><span class="o">.</span><span class="n">cxn_struct</span> <span class="ow">and</span>
                    <span class="n">cxn_inst2</span><span class="o">.</span><span class="n">cxn_struct</span><span class="p">):</span>
                <span class="c">###############################################################</span>
                <span class="c"># Alternative version</span>
                <span class="c">###############################################################</span>
<span class="c">#                INST.CXN_INST.match(cxn_inst1, cxn_inst2, mat_info)</span>
<span class="c">#                if (mat_info.overlap and</span>
<span class="c">#                    cxn_inst1.cxn_struct and</span>
<span class="c">#                    not(cxn_inst1.cxn_struct.check_membership(cxn = cxn_inst2)) and</span>
<span class="c">#                    cxn_str2 and</span>
<span class="c">#                    not(cxn_inst2.cxn_struct.check_membership(cxn = cxn_inst1))):</span>
                <span class="c">###############################################################    </span>
                    <span class="c"># Do not tie break in order to prevent reciprocal elimination</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">cxn_inst1</span><span class="o">.</span><span class="n">cxn_struct</span><span class="o">.</span><span class="n">suitability</span> <span class="o">&gt;</span> <span class="n">cxn_inst2</span><span class="o">.</span><span class="n">cxn_struct</span><span class="o">.</span><span class="n">suitability</span> <span class="ow">and</span> <span class="n">cxn_inst2</span><span class="o">.</span><span class="n">alive</span><span class="p">):</span>
                        <span class="n">cxn_inst2</span><span class="o">.</span><span class="n">Alive</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">create_comp_trace</span><span class="p">(</span><span class="n">cxn_inst1</span><span class="p">,</span> <span class="n">cxn_inst2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">cxn_inst1</span><span class="o">.</span><span class="n">cxn_struct</span><span class="o">.</span><span class="n">suitability</span> <span class="o">&lt;</span> <span class="n">cxn_inst2</span><span class="o">.</span><span class="n">cxn_struct</span><span class="o">.</span><span class="n">suitability</span> <span class="ow">and</span> <span class="n">cxn_inst1</span><span class="o">.</span><span class="n">alive</span><span class="p">):</span>
                        <span class="n">cxn_inst1</span><span class="o">.</span><span class="n">Alive</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">create_comp_trace</span><span class="p">(</span><span class="n">cxn_inst2</span><span class="p">,</span> <span class="n">cxn_inst1</span><span class="p">)</span>
                        </div>
<div class="viewcode-block" id="SIMULATOR.process_constructions"><a class="viewcode-back" href="../code.html#simulator.SIMULATOR.process_constructions">[docs]</a>    <span class="k">def</span> <span class="nf">process_constructions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        WRITE DOCSTRING!!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Cooperation process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_cooperation</span><span class="p">()</span>
        
        <span class="c"># Trim obsolete structures (i.e. covering old cxn instances only)</span>
        <span class="k">for</span> <span class="n">cxn_str</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cxn_strs</span><span class="p">[:]:</span>
            <span class="k">if</span> <span class="n">cxn_str</span><span class="o">.</span><span class="n">check_obsolete</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cxn_strs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cxn_str</span><span class="p">)</span>
        
        <span class="c"># Trim redundant construction structures</span>
        <span class="k">for</span> <span class="n">cxn_str</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cxn_strs</span><span class="p">[:]:</span>
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_cxn_struct</span><span class="p">(</span><span class="n">cxn_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cxn_strs</span><span class="p">,</span> <span class="mi">2</span><span class="p">)):</span> <span class="c"># cxn_str is included in another structure</span>
            
            <span class="c">###################################################################</span>
            <span class="c"># Alternative version</span>
            <span class="c">###################################################################</span>
<span class="c">#            if (not(cxn_str.check_complete) and </span>
<span class="c">#                self.find_cxn_struct(cxn_str, self.cxn_strs, 2)):</span>
            <span class="c">###################################################################            </span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cxn_strs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cxn_str</span><span class="p">)</span>
        
        <span class="c"># Utterance continuity principle</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">utter_cont</span><span class="p">:</span>
            <span class="c"># Adjust suitability</span>
            <span class="k">for</span> <span class="n">cxn_str</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cxn_strs</span><span class="p">:</span>
                <span class="c"># Estimate the number of overlapped syntactic components</span>
                <span class="n">overlap</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">cxn_inst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd_str</span><span class="o">.</span><span class="n">insts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cxn_str</span><span class="o">.</span><span class="n">check_membership</span><span class="p">(</span><span class="n">cxn</span> <span class="o">=</span> <span class="n">cxn_inst</span><span class="p">):</span>
                        <span class="n">overlap</span> <span class="o">+=</span><span class="mi">1</span>
                <span class="k">for</span> <span class="n">cxn_link</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd_str</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cxn_str</span><span class="o">.</span><span class="n">check_membership</span><span class="p">(</span><span class="n">link</span> <span class="o">=</span> <span class="n">cxn_link</span><span class="p">):</span>
                        <span class="n">overlap</span> <span class="o">+=</span><span class="mi">1</span>
                
                <span class="n">continued</span> <span class="o">=</span> <span class="bp">False</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd_str</span><span class="o">.</span><span class="n">check_lineage</span><span class="p">(</span><span class="n">cxn_str</span><span class="p">):</span>
                    <span class="c"># Produce subvocal utterace (vocal = False)</span>
                    <span class="n">phons</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">cxn_str</span><span class="o">.</span><span class="n">readout</span><span class="p">(</span><span class="n">cxn_str</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">phons</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
                    <span class="n">skip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_phon_lists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rd_phons</span><span class="p">,</span> <span class="n">phons</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rd_phons</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">skip</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span> <span class="c"># Check if utterance can be made continuously</span>
                        <span class="n">continued</span> <span class="o">=</span> <span class="bp">True</span>

                <span class="k">if</span> <span class="n">continued</span><span class="p">:</span>
                    <span class="c"># Continuity reward</span>
                    <span class="n">cxn_str</span><span class="o">.</span><span class="n">suitability</span> <span class="o">+=</span> <span class="n">overlap</span> <span class="o">*</span> <span class="n">INST</span><span class="o">.</span><span class="n">CXN_STRUCT</span><span class="o">.</span><span class="n">RDD_WEIGHT</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Redundancy penalty</span>
                    <span class="n">cxn_str</span><span class="o">.</span><span class="n">suitability</span> <span class="o">-=</span> <span class="n">overlap</span> <span class="o">*</span> <span class="n">INST</span><span class="o">.</span><span class="n">CXN_STRUCT</span><span class="o">.</span><span class="n">RDD_WEIGHT</span>
        
        <span class="c"># Associate construction instances with structure of maximum suitability</span>
        <span class="k">for</span> <span class="n">cxn_inst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cxn_insts</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">cxn_inst</span><span class="o">.</span><span class="n">alive</span><span class="p">):</span>
                <span class="k">continue</span>
            
            <span class="k">for</span> <span class="n">cxn_str</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cxn_strs</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">cxn_str</span><span class="o">.</span><span class="n">check_membership</span><span class="p">(</span><span class="n">cxn</span> <span class="o">=</span> <span class="n">cxn_inst</span><span class="p">)):</span>
                    <span class="k">continue</span>
                
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span><span class="p">(</span><span class="n">cxn_inst</span><span class="o">.</span><span class="n">cxn_struct</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_randmax</span><span class="p">(</span><span class="n">cxn_inst</span><span class="o">.</span><span class="n">cxn_struct</span><span class="o">.</span><span class="n">suitability</span><span class="p">,</span> <span class="n">cxn_str</span><span class="o">.</span><span class="n">suitability</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">cxn_inst</span><span class="o">.</span><span class="n">cxn_struct</span> <span class="o">=</span> <span class="n">cxn_str</span>
        
        <span class="c"># Competition process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_competition</span><span class="p">()</span>
        
        <span class="c"># Invalidate construction structures that contain dead construction instances</span>
        <span class="k">for</span> <span class="n">cxn_str</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cxn_strs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cxn_inst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cxn_insts</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cxn_inst</span><span class="o">.</span><span class="n">alive</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">cxn_str</span><span class="o">.</span><span class="n">check_membership</span><span class="p">(</span><span class="n">cxn</span> <span class="o">=</span> <span class="n">cxn_inst</span><span class="p">):</span>
                    <span class="n">cxn_str</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="bp">False</span>
            
            
    <span class="c">###########################################################################</span></div>
<div class="viewcode-block" id="SIMULATOR.match_phon_lists"><a class="viewcode-back" href="../code.html#simulator.SIMULATOR.match_phon_lists">[docs]</a>    <span class="k">def</span> <span class="nf">match_phon_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prev_phonlist</span><span class="p">,</span> <span class="n">next_phonlist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if there is an i such that prev_phonlist[i:] is a sublist of next_phonlist</span>
<span class="sd">        </span>
<span class="sd">        Example:</span>
<span class="sd">            prev_phonlist = [I, saw, that, the, man, kicks]</span>
<span class="sd">            next_phonlist = [The, man, kicks, a, ball]</span>
<span class="sd">            Return -&gt; matches = 3, corresponds to index of &#39;a&#39; in next_phon_list.</span>
<span class="sd">            </span>
<span class="sd">            prev_phonlist = [I, saw, that, the, man, kicks]</span>
<span class="sd">            next_phonlist = [the, man, eats, a, cake]</span>
<span class="sd">            Return -&gt; matches = 0, prev_phonlist is not a sublist of next_phonlist.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prev_phonlist</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">next_phonlist</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span> <span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">prev_phonlist</span><span class="p">)</span> <span class="ow">and</span> <span class="n">prev_phonlist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">next_phonlist</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prev_phonlist</span><span class="p">):</span>
                    <span class="n">matches</span> <span class="o">=</span> <span class="n">j</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
        
        <span class="k">return</span> <span class="n">matches</span>
                
    </div>
<div class="viewcode-block" id="SIMULATOR.produce_utterance"><a class="viewcode-back" href="../code.html#simulator.SIMULATOR.produce_utterance">[docs]</a>    <span class="k">def</span> <span class="nf">produce_utterance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        WRITE DOCSTRING!!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Reset utterance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utter</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        
        <span class="c"># Bypass threshold if no more update from vision or previous utterance was incomplete</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vis_update</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">incomp_utter</span><span class="p">):</span>
            <span class="c"># Calculate the total syllable length</span>
            <span class="n">totLen</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresh_syll</span> <span class="o">&gt;=</span><span class="mi">0</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">cxn_inst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cxn_insts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">cxn_inst</span><span class="o">.</span><span class="n">alive</span><span class="p">):</span>
                        <span class="k">continue</span>
                    
                    <span class="k">for</span> <span class="n">form_elem</span> <span class="ow">in</span> <span class="n">cxn_inst</span><span class="o">.</span><span class="n">base_cxn</span><span class="o">.</span><span class="n">SynForm</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">form_elem</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">CXN</span><span class="o">.</span><span class="n">TP_ELEM</span><span class="o">.</span><span class="n">SLOT</span><span class="p">:</span>
                            <span class="n">totLen</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">form_elem</span><span class="o">.</span><span class="n">phonetics</span><span class="p">)</span>
        
            <span class="c"># Check utterance thresholds are reached</span>
            <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">thresh_time</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresh_time</span> <span class="o">&gt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">utter_time</span><span class="p">))</span> <span class="ow">and</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresh_cxn</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresh_cxn</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cxn_insts</span><span class="p">))</span> <span class="ow">and</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresh_syll</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresh_syll</span> <span class="o">&gt;</span> <span class="n">totLen</span><span class="p">)):</span>
                <span class="k">return</span> <span class="c"># thretholds not reached yet</span>
        
        <span class="c"># Select construction structure to be read out</span>
        <span class="n">select_str</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">cxn_str</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cxn_strs</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="ow">not</span><span class="p">(</span><span class="n">select_str</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_randmax</span><span class="p">(</span><span class="n">select_str</span><span class="o">.</span><span class="n">suitability</span><span class="p">,</span> <span class="n">cxn_str</span><span class="o">.</span><span class="n">suitability</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">select_str</span> <span class="o">=</span> <span class="n">cxn_str</span>
                    
        
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">select_str</span><span class="p">):</span>
            <span class="c"># Reset utterance variables</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incomp_utter</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rd_phons</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rd_str</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Read out phonetic notations</span>
            <span class="n">phons</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">unspoken</span> <span class="o">=</span> <span class="n">select_str</span><span class="o">.</span><span class="n">readout</span><span class="p">(</span><span class="n">select_str</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">phons</span><span class="p">)</span>
            
            <span class="c"># Skip previously spoken utterance (only within the same lineage)</span>
            <span class="n">skip</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd_str</span><span class="o">.</span><span class="n">check_lineage</span><span class="p">(</span><span class="n">select_str</span><span class="p">):</span>
                <span class="n">skip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_phon_lists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rd_phons</span><span class="p">,</span> <span class="n">phons</span><span class="p">)</span>
            
            <span class="c"># reset utterance variables</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incomp_utter</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">utter_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rd_phons</span> <span class="o">=</span> <span class="n">phons</span><span class="p">[:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rd_str</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rd_str</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">select_str</span><span class="o">.</span><span class="n">top</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rd_str</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">select_str</span><span class="p">)</span>
            
            <span class="c"># If there are unspoken elements, verbal guidance and premature production kick in.</span>
            <span class="k">if</span> <span class="n">unspoken</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">incomp_utter</span> <span class="o">=</span> <span class="bp">True</span>
                
                <span class="c"># Verbal guidance principle</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verb_guide</span><span class="p">:</span>
                    <span class="n">rgn</span> <span class="o">=</span> <span class="n">unspoken</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">region</span>
                    <span class="k">if</span> <span class="n">rgn</span><span class="o">.</span><span class="n">uncertainty</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">next_atten</span> <span class="o">=</span> <span class="n">rgn</span> <span class="c"># Sets the next attentional focus.</span>
                
                <span class="c"># Premature production principle</span>
                <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prema_prod</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">select_str</span><span class="o">.</span><span class="n">check_complete</span><span class="p">()):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rd_phons</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># If the structure is not complete and no premature prod -&gt; do not utter anything.</span>
            
            <span class="c"># Render utterance.</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="c"># Adding the already uttered part in parenthesis</span>
                <span class="k">if</span> <span class="n">skip</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">utter</span> <span class="o">+=</span> <span class="s">&#39;(&#39;</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">skip</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">utter</span> <span class="o">+=</span> <span class="s">&#39; &#39;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">utter</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd_phons</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">phonetics</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">utter</span> <span class="o">+=</span> <span class="s">&#39;)&#39;</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">skip</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rd_phons</span><span class="p">)):</span>
                <span class="n">phon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rd_phons</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">phonetics</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">phon</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;-&#39;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">utter</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">utter</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;-&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">utter</span> <span class="o">+=</span> <span class="s">&#39; &#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">utter</span> <span class="o">+=</span> <span class="n">phon</span>
            
            <span class="c"># Append prolonged pause</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">unspoken</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">utter</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">utter</span> <span class="o">+=</span> <span class="s">&#39;...&#39;</span> <span class="c"># Incomplete utterance</span>
            
            <span class="c"># Append verbalized pause when nothing to produce</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">utter</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">utter</span> <span class="o">+=</span> <span class="s">&#39;uh...&#39;</span>
    <span class="c">###########################################################################</span>
    <span class="c"># PUBLIC METHODS</span>
    <span class="c">###########################################################################</span></div>
<div class="viewcode-block" id="SIMULATOR.proceed"><a class="viewcode-back" href="../code.html#simulator.SIMULATOR.proceed">[docs]</a>    <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        WRITE DOCSTRING!!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_time</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        
        <span class="n">INST</span><span class="o">.</span><span class="n">SCHEMA_INST</span><span class="o">.</span><span class="n">inst_activity</span> <span class="o">=</span> <span class="bp">False</span>
        
        <span class="c"># Maintenance processes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ellapsed_time</span><span class="p">()</span>
        
        <span class="c"># Vision processes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deploy_attention</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">perceive_scene</span><span class="p">()</span>
        
        <span class="c"># TCG processes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invoke_constructions</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">process_constructions</span><span class="p">()</span>
        
        <span class="c"># Utterance processes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">produce_utterance</span><span class="p">(</span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">(</span><span class="n">INST</span><span class="o">.</span><span class="n">SCHEMA_INST</span><span class="o">.</span><span class="n">inst_activity</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">vis_update</span><span class="p">)</span>
    
<span class="c">###############################################################################</span>
</div></div>
<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;No test case implemented&quot;</span>
    
        
        
        
        
    
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TCG 1.1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Victor Barres.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3b3.
    </div>
  </body>
</html>